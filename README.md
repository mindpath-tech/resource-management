# Abi

Abi is a smart AI assistant that helps you & your procurement team to get answers to any sourcing query with relevant data points in the shortest possible time. You can also find answers to queries related to the following areas from both proprietary and partner-led information databases -

- Category Intelligence

- Supplier Shortlisting

- Risk & Compliance

- Category Benchmarks

- Market Monitoring Dashboards

- Commodity Price and Cost Drivers

# Setup

## Prerequisite

- Install Node js (v14.16.0)
- Install mysql database.
- Checkout project from repository.
- Create database on mysql database.
- Create environment file names '.env'
- Add environment variables in .env file refer 'example.env' file in the repository for sample .

## Run the node server in development mode

- Install packages using cmd `npm install`
- Run migration using cmd `npm run migrate:run`
- Run server using cmd `npm run watch` or `npm run start:dev`

## Run the node server in production mode

- Install packages using cmd `npm install`
- Run server using cmd `npm start`

# Application Structure

```
├── Dockerfile               // Standard docker file to start server on docker.
├── README.md
├── azure-pipelines.yml     // Standard file for Azure Ci/Cd
├── example.env             // Reference file for .env
├── migration               // Typeorm migrations.
├── ormconfig.js            // Typeorm specific configuration file.
├── package-lock.json       // Package lock generated by npm on install.
├── package.json            // Standard package.json file
├── script                  // Script or date migration files.
│   └── insertUser.ts       // Migration file to insert user details in database.
├── deployment               // Stuff related to deployment
├── src                     // This folder contain all the source codes.
│   ├── assets              // Place to keep assets files. For example images, css etc.
│   ├── bot                 // Contains botframework specific files
│   ├── config.ts           // Contain typeorm and database configurations.
│   ├── connectors          // Connectors to connect channel such as freshchat and teams.
│   ├── constants           // Place to keep all the constants file.
│   ├── controllers         // Controllers are organized by module names for apis.
│   ├── dialogs             // Dialogs are organized by bot flow. All the bot flow steps are written in dialogs.
│   ├── enum                // Contains all the enum files created for the project.
│   ├── helper              // Contains some helper class such as context, logging, axios.
│   ├── index.ts            // Main server file.
│   ├── middleware          // Contain middleware which will be triggered for new request or message.
│   ├── models              // Contain all the database models.
│   ├── parsers             // Parser to parse message format from one channel to another.
│   ├── prompts             // Customized prompt for dialog flow.
│   ├── repository          // Responsible for any database or external service call.
│   ├── routes              // Module name wise api endpoint.
│   ├── schedular           // All the schedular which will run on specific time to perform task in background.
│   ├── service             // Service layer to perform most of the business logics.
│   ├── types               // Contain all the typescript types or interface.
│   └── utils               // Contain some utility functions.
└── tsconfig.json           // Typescript configuration file.
```

# Deployment

![](src/assets/deploymentDiagram.png)

## Aws

- Set all environment variables defined in example.env with actual values on cloud machine.
- Deploy source of this repository to aws. We can use docker based deployment through CI/CD.
- Associate domain with the server url.

## Azure

- Create a resource group on azure.
- Create a azure bot service under this azure resource group.
- Generate secret for azure bot service.
- Get MicrosoftAppId and MicrosoftAppPassword value and place in environment variables.
  - Open Azure bot service.
  - Go to `settings/configuration`
  - Here Microsoft App ID is our 'MicrosoftAppId'
  - Click on 'Manage' link.
  - Go to `Client secrets (2) -> New Client Secret`
  - Select expiry.
  - Click on add button.
  - Here Value will be our 'MicrosoftAppPassword'
- Go to configured section under settings in azure bot and add messaging endpoint
- Messaging endpoint will be look like this `${serviceUrl}/api/messages` where 'serviceUrl' is the url we got from aws deployment.

## LiveChat

## Teams

Under deployment directory of this repository we will be able find manifest file under teams directory. We have to make some changes on manifest file and create zip of teams directory to deploy app on teams.

- Update botId in manifest file.

  - Here is botId is MicrosoftAppId which we have got from bot service.
  - Open Azure bot service.
  - Go to `settings/configuration`
  - Here Microsoft App ID is our 'botId'

- Update Id field in manifest file.
  - Generate random guidId and update Id field with this guid.
- Create a zip file of teams folder present inside deployment folder.

### Following actions needs to be performed by the Microsoft Teams Administration

- In the left navigation of the Microsoft Teams admin center https://admin.teams.microsoft.com, go to Teams apps > Manage apps.

- Click upload, click select a file, and then select the app package (zip file) that you have created on above step.

### Instructions to install app

- Go to apps option in Teams.
- Search into built for your org you will be able to see all your organization apps.
- Click on the app and add it.
